<!DOCTYPE HTML>
<html lang="en">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
</head>
<body>
<main role="main">
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span><a id="line.1">/*</a>
<span class="sourceLineNo">002</span><a id="line.2"> * Copyright (C) 2009 The Guava Authors</a>
<span class="sourceLineNo">003</span><a id="line.3"> *</a>
<span class="sourceLineNo">004</span><a id="line.4"> * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except</a>
<span class="sourceLineNo">005</span><a id="line.5"> * in compliance with the License. You may obtain a copy of the License at</a>
<span class="sourceLineNo">006</span><a id="line.6"> *</a>
<span class="sourceLineNo">007</span><a id="line.7"> * http://www.apache.org/licenses/LICENSE-2.0</a>
<span class="sourceLineNo">008</span><a id="line.8"> *</a>
<span class="sourceLineNo">009</span><a id="line.9"> * Unless required by applicable law or agreed to in writing, software distributed under the License</a>
<span class="sourceLineNo">010</span><a id="line.10"> * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express</a>
<span class="sourceLineNo">011</span><a id="line.11"> * or implied. See the License for the specific language governing permissions and limitations under</a>
<span class="sourceLineNo">012</span><a id="line.12"> * the License.</a>
<span class="sourceLineNo">013</span><a id="line.13"> */</a>
<span class="sourceLineNo">014</span><a id="line.14"></a>
<span class="sourceLineNo">015</span><a id="line.15">package com.google.common.xml;</a>
<span class="sourceLineNo">016</span><a id="line.16"></a>
<span class="sourceLineNo">017</span><a id="line.17">import com.google.common.annotations.Beta;</a>
<span class="sourceLineNo">018</span><a id="line.18">import com.google.common.annotations.GwtCompatible;</a>
<span class="sourceLineNo">019</span><a id="line.19">import com.google.common.escape.Escaper;</a>
<span class="sourceLineNo">020</span><a id="line.20">import com.google.common.escape.Escapers;</a>
<span class="sourceLineNo">021</span><a id="line.21"></a>
<span class="sourceLineNo">022</span><a id="line.22">/**</a>
<span class="sourceLineNo">023</span><a id="line.23"> * {@code Escaper} instances suitable for strings to be included in XML attribute values and</a>
<span class="sourceLineNo">024</span><a id="line.24"> * elements' text contents. When possible, avoid manual escaping by using templating systems and</a>
<span class="sourceLineNo">025</span><a id="line.25"> * high-level APIs that provide autoescaping. For example, consider &lt;a</a>
<span class="sourceLineNo">026</span><a id="line.26"> * href="http://www.xom.nu/"&gt;XOM&lt;/a&gt; or &lt;a href="http://www.jdom.org/"&gt;JDOM&lt;/a&gt;.</a>
<span class="sourceLineNo">027</span><a id="line.27"> *</a>
<span class="sourceLineNo">028</span><a id="line.28"> * &lt;p&gt;&lt;b&gt;Note:&lt;/b&gt; Currently the escapers provided by this class do not escape any characters</a>
<span class="sourceLineNo">029</span><a id="line.29"> * outside the ASCII character range. Unlike HTML escaping the XML escapers will not escape</a>
<span class="sourceLineNo">030</span><a id="line.30"> * non-ASCII characters to their numeric entity replacements. These XML escapers provide the minimal</a>
<span class="sourceLineNo">031</span><a id="line.31"> * level of escaping to ensure that the output can be safely included in a Unicode XML document.</a>
<span class="sourceLineNo">032</span><a id="line.32"> *</a>
<span class="sourceLineNo">033</span><a id="line.33"> * &lt;p&gt;For details on the behavior of the escapers in this class, see sections &lt;a</a>
<span class="sourceLineNo">034</span><a id="line.34"> * href="http://www.w3.org/TR/2008/REC-xml-20081126/#charsets"&gt;2.2&lt;/a&gt; and &lt;a</a>
<span class="sourceLineNo">035</span><a id="line.35"> * href="http://www.w3.org/TR/2008/REC-xml-20081126/#syntax"&gt;2.4&lt;/a&gt; of the XML specification.</a>
<span class="sourceLineNo">036</span><a id="line.36"> *</a>
<span class="sourceLineNo">037</span><a id="line.37"> * @author Alex Matevossian</a>
<span class="sourceLineNo">038</span><a id="line.38"> * @author David Beaumont</a>
<span class="sourceLineNo">039</span><a id="line.39"> * @since 15.0</a>
<span class="sourceLineNo">040</span><a id="line.40"> */</a>
<span class="sourceLineNo">041</span><a id="line.41">@Beta</a>
<span class="sourceLineNo">042</span><a id="line.42">@GwtCompatible</a>
<span class="sourceLineNo">043</span><a id="line.43">@ElementTypesAreNonnullByDefault</a>
<span class="sourceLineNo">044</span><a id="line.44">public class XmlEscapers {</a>
<span class="sourceLineNo">045</span><a id="line.45">  private XmlEscapers() {}</a>
<span class="sourceLineNo">046</span><a id="line.46"></a>
<span class="sourceLineNo">047</span><a id="line.47">  private static final char MIN_ASCII_CONTROL_CHAR = 0x00;</a>
<span class="sourceLineNo">048</span><a id="line.48">  private static final char MAX_ASCII_CONTROL_CHAR = 0x1F;</a>
<span class="sourceLineNo">049</span><a id="line.49"></a>
<span class="sourceLineNo">050</span><a id="line.50">  // For each xxxEscaper() method, please add links to external reference pages</a>
<span class="sourceLineNo">051</span><a id="line.51">  // that are considered authoritative for the behavior of that escaper.</a>
<span class="sourceLineNo">052</span><a id="line.52"></a>
<span class="sourceLineNo">053</span><a id="line.53">  /**</a>
<span class="sourceLineNo">054</span><a id="line.54">   * Returns an {@link Escaper} instance that escapes special characters in a string so it can</a>
<span class="sourceLineNo">055</span><a id="line.55">   * safely be included in an XML document as element content. See section &lt;a</a>
<span class="sourceLineNo">056</span><a id="line.56">   * href="http://www.w3.org/TR/2008/REC-xml-20081126/#syntax"&gt;2.4&lt;/a&gt; of the XML specification.</a>
<span class="sourceLineNo">057</span><a id="line.57">   *</a>
<span class="sourceLineNo">058</span><a id="line.58">   * &lt;p&gt;&lt;b&gt;Note:&lt;/b&gt; Double and single quotes are not escaped, so it is &lt;b&gt;not safe&lt;/b&gt; to use this</a>
<span class="sourceLineNo">059</span><a id="line.59">   * escaper to escape attribute values. Use {@link #xmlContentEscaper} if the output can appear in</a>
<span class="sourceLineNo">060</span><a id="line.60">   * element content or {@link #xmlAttributeEscaper} in attribute values.</a>
<span class="sourceLineNo">061</span><a id="line.61">   *</a>
<span class="sourceLineNo">062</span><a id="line.62">   * &lt;p&gt;This escaper substitutes {@code 0xFFFD} for non-whitespace control characters and the</a>
<span class="sourceLineNo">063</span><a id="line.63">   * character values {@code 0xFFFE} and {@code 0xFFFF} which are not permitted in XML. For more</a>
<span class="sourceLineNo">064</span><a id="line.64">   * detail see section &lt;a href="http://www.w3.org/TR/2008/REC-xml-20081126/#charsets"&gt;2.2&lt;/a&gt; of</a>
<span class="sourceLineNo">065</span><a id="line.65">   * the XML specification.</a>
<span class="sourceLineNo">066</span><a id="line.66">   *</a>
<span class="sourceLineNo">067</span><a id="line.67">   * &lt;p&gt;This escaper does not escape non-ASCII characters to their numeric character references</a>
<span class="sourceLineNo">068</span><a id="line.68">   * (NCR). Any non-ASCII characters appearing in the input will be preserved in the output.</a>
<span class="sourceLineNo">069</span><a id="line.69">   * Specifically "\r" (carriage return) is preserved in the output, which may result in it being</a>
<span class="sourceLineNo">070</span><a id="line.70">   * silently converted to "\n" when the XML is parsed.</a>
<span class="sourceLineNo">071</span><a id="line.71">   *</a>
<span class="sourceLineNo">072</span><a id="line.72">   * &lt;p&gt;This escaper does not treat surrogate pairs specially and does not perform Unicode</a>
<span class="sourceLineNo">073</span><a id="line.73">   * validation on its input.</a>
<span class="sourceLineNo">074</span><a id="line.74">   */</a>
<span class="sourceLineNo">075</span><a id="line.75">  public static Escaper xmlContentEscaper() {</a>
<span class="sourceLineNo">076</span><a id="line.76">    return XML_CONTENT_ESCAPER;</a>
<span class="sourceLineNo">077</span><a id="line.77">  }</a>
<span class="sourceLineNo">078</span><a id="line.78"></a>
<span class="sourceLineNo">079</span><a id="line.79">  /**</a>
<span class="sourceLineNo">080</span><a id="line.80">   * Returns an {@link Escaper} instance that escapes special characters in a string so it can</a>
<span class="sourceLineNo">081</span><a id="line.81">   * safely be included in XML document as an attribute value. See section &lt;a</a>
<span class="sourceLineNo">082</span><a id="line.82">   * href="http://www.w3.org/TR/2008/REC-xml-20081126/#AVNormalize"&gt;3.3.3&lt;/a&gt; of the XML</a>
<span class="sourceLineNo">083</span><a id="line.83">   * specification.</a>
<span class="sourceLineNo">084</span><a id="line.84">   *</a>
<span class="sourceLineNo">085</span><a id="line.85">   * &lt;p&gt;This escaper substitutes {@code 0xFFFD} for non-whitespace control characters and the</a>
<span class="sourceLineNo">086</span><a id="line.86">   * character values {@code 0xFFFE} and {@code 0xFFFF} which are not permitted in XML. For more</a>
<span class="sourceLineNo">087</span><a id="line.87">   * detail see section &lt;a href="http://www.w3.org/TR/2008/REC-xml-20081126/#charsets"&gt;2.2&lt;/a&gt; of</a>
<span class="sourceLineNo">088</span><a id="line.88">   * the XML specification.</a>
<span class="sourceLineNo">089</span><a id="line.89">   *</a>
<span class="sourceLineNo">090</span><a id="line.90">   * &lt;p&gt;This escaper does not escape non-ASCII characters to their numeric character references</a>
<span class="sourceLineNo">091</span><a id="line.91">   * (NCR). However, horizontal tab {@code '\t'}, line feed {@code '\n'} and carriage return {@code</a>
<span class="sourceLineNo">092</span><a id="line.92">   * '\r'} are escaped to a corresponding NCR {@code "&amp;#x9;"}, {@code "&amp;#xA;"}, and {@code "&amp;#xD;"}</a>
<span class="sourceLineNo">093</span><a id="line.93">   * respectively. Any other non-ASCII characters appearing in the input will be preserved in the</a>
<span class="sourceLineNo">094</span><a id="line.94">   * output.</a>
<span class="sourceLineNo">095</span><a id="line.95">   *</a>
<span class="sourceLineNo">096</span><a id="line.96">   * &lt;p&gt;This escaper does not treat surrogate pairs specially and does not perform Unicode</a>
<span class="sourceLineNo">097</span><a id="line.97">   * validation on its input.</a>
<span class="sourceLineNo">098</span><a id="line.98">   */</a>
<span class="sourceLineNo">099</span><a id="line.99">  public static Escaper xmlAttributeEscaper() {</a>
<span class="sourceLineNo">100</span><a id="line.100">    return XML_ATTRIBUTE_ESCAPER;</a>
<span class="sourceLineNo">101</span><a id="line.101">  }</a>
<span class="sourceLineNo">102</span><a id="line.102"></a>
<span class="sourceLineNo">103</span><a id="line.103">  private static final Escaper XML_ESCAPER;</a>
<span class="sourceLineNo">104</span><a id="line.104">  private static final Escaper XML_CONTENT_ESCAPER;</a>
<span class="sourceLineNo">105</span><a id="line.105">  private static final Escaper XML_ATTRIBUTE_ESCAPER;</a>
<span class="sourceLineNo">106</span><a id="line.106"></a>
<span class="sourceLineNo">107</span><a id="line.107">  static {</a>
<span class="sourceLineNo">108</span><a id="line.108">    Escapers.Builder builder = Escapers.builder();</a>
<span class="sourceLineNo">109</span><a id="line.109">    // The char values \uFFFE and \uFFFF are explicitly not allowed in XML</a>
<span class="sourceLineNo">110</span><a id="line.110">    // (Unicode code points above \uFFFF are represented via surrogate pairs</a>
<span class="sourceLineNo">111</span><a id="line.111">    // which means they are treated as pairs of safe characters).</a>
<span class="sourceLineNo">112</span><a id="line.112">    builder.setSafeRange(Character.MIN_VALUE, '\uFFFD');</a>
<span class="sourceLineNo">113</span><a id="line.113">    // Unsafe characters are replaced with the Unicode replacement character.</a>
<span class="sourceLineNo">114</span><a id="line.114">    builder.setUnsafeReplacement("\uFFFD");</a>
<span class="sourceLineNo">115</span><a id="line.115"></a>
<span class="sourceLineNo">116</span><a id="line.116">    /*</a>
<span class="sourceLineNo">117</span><a id="line.117">     * Except for \n, \t, and \r, all ASCII control characters are replaced with the Unicode</a>
<span class="sourceLineNo">118</span><a id="line.118">     * replacement character.</a>
<span class="sourceLineNo">119</span><a id="line.119">     *</a>
<span class="sourceLineNo">120</span><a id="line.120">     * Implementation note: An alternative to the following would be to make a map that simply</a>
<span class="sourceLineNo">121</span><a id="line.121">     * replaces the allowed ASCII whitespace characters with themselves and to set the minimum safe</a>
<span class="sourceLineNo">122</span><a id="line.122">     * character to 0x20. However this would slow down the escaping of simple strings that contain</a>
<span class="sourceLineNo">123</span><a id="line.123">     * \t, \n, or \r.</a>
<span class="sourceLineNo">124</span><a id="line.124">     */</a>
<span class="sourceLineNo">125</span><a id="line.125">    for (char c = MIN_ASCII_CONTROL_CHAR; c &lt;= MAX_ASCII_CONTROL_CHAR; c++) {</a>
<span class="sourceLineNo">126</span><a id="line.126">      if (c != '\t' &amp;&amp; c != '\n' &amp;&amp; c != '\r') {</a>
<span class="sourceLineNo">127</span><a id="line.127">        builder.addEscape(c, "\uFFFD");</a>
<span class="sourceLineNo">128</span><a id="line.128">      }</a>
<span class="sourceLineNo">129</span><a id="line.129">    }</a>
<span class="sourceLineNo">130</span><a id="line.130"></a>
<span class="sourceLineNo">131</span><a id="line.131">    // Build the content escaper first and then add quote escaping for the</a>
<span class="sourceLineNo">132</span><a id="line.132">    // general escaper.</a>
<span class="sourceLineNo">133</span><a id="line.133">    builder.addEscape('&amp;', "&amp;amp;");</a>
<span class="sourceLineNo">134</span><a id="line.134">    builder.addEscape('&lt;', "&amp;lt;");</a>
<span class="sourceLineNo">135</span><a id="line.135">    builder.addEscape('&gt;', "&amp;gt;");</a>
<span class="sourceLineNo">136</span><a id="line.136">    XML_CONTENT_ESCAPER = builder.build();</a>
<span class="sourceLineNo">137</span><a id="line.137">    builder.addEscape('\'', "&amp;apos;");</a>
<span class="sourceLineNo">138</span><a id="line.138">    builder.addEscape('"', "&amp;quot;");</a>
<span class="sourceLineNo">139</span><a id="line.139">    XML_ESCAPER = builder.build();</a>
<span class="sourceLineNo">140</span><a id="line.140">    builder.addEscape('\t', "&amp;#x9;");</a>
<span class="sourceLineNo">141</span><a id="line.141">    builder.addEscape('\n', "&amp;#xA;");</a>
<span class="sourceLineNo">142</span><a id="line.142">    builder.addEscape('\r', "&amp;#xD;");</a>
<span class="sourceLineNo">143</span><a id="line.143">    XML_ATTRIBUTE_ESCAPER = builder.build();</a>
<span class="sourceLineNo">144</span><a id="line.144">  }</a>
<span class="sourceLineNo">145</span><a id="line.145">}</a>




























































</pre>
</div>
</main>
</body>
</html>
